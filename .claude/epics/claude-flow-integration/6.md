---
name: Service Foundation - Create systemd service with GitHub polling
status: closed
created: 2025-08-29T22:39:05Z
updated: 2025-08-30T20:15:40Z
github: https://github.com/microservice-tech/ccpm/issues/6
depends_on: [18]
parallel: false
conflicts_with: []
completion: 100
---

# Task 6: Service Foundation - Create systemd service with GitHub polling

## Description

Create the foundational service infrastructure that implements the complete per-issue workflow orchestration. This Python-based systemd service continuously polls GitHub for issues labeled "ready-for-implementation" and, for each issue, executes the full isolated workflow: creating a workspace, cloning the repo, creating a branch, installing Claude Flow locally, spawning the hive-mind, monitoring implementation, creating the PR, and cleaning up.

The service orchestrates the entire lifecycle of issue implementation in isolated environments, ensuring each issue gets its own clean Claude Flow installation and workspace. This prevents state contamination and enables parallel processing of multiple issues without conflicts.

## Acceptance Criteria

- [ ] Python service script `claude-flow-service.py` created and functional
- [ ] systemd service unit file properly configured for automatic startup
- [ ] GitHub API integration working with proper authentication
- [ ] Polling mechanism runs every 5 minutes without memory leaks
- [ ] Per-issue workflow execution with isolated workspaces
- [ ] Local Claude Flow installation per issue working
- [ ] Hive-mind spawn with issue-specific prompts
- [ ] PR creation after successful implementation
- [ ] Workspace cleanup after PR creation
- [ ] Service logs all activities with appropriate log levels
- [ ] Error handling for network failures and API rate limits
- [ ] Service can be started, stopped, and restarted reliably
- [ ] Configuration file for GitHub token and repository settings
- [ ] Concurrent issue processing without conflicts

## Technical Details

### Service Architecture
- Python service using `requests` library for GitHub API calls
- `systemd` service configuration for system-level management
- JSON configuration file for GitHub repository and authentication details
- Subprocess management for workflow execution
- Isolated workspace creation in `/tmp/claude-flow-issues/`
- Per-issue workflow script execution
- Concurrent issue processing with process pool
- Robust logging using Python's `logging` module
- Signal handling for graceful shutdown

### Per-Issue Workflow Steps
1. Detect issue with "ready-for-implementation" label
2. Create isolated workspace: `/tmp/claude-flow-issues/issue-{id}/`
3. Clone repository to workspace
4. Create feature branch: `feature/issue-{id}`
5. Install Claude Flow locally: `npm install claude-flow@alpha`
6. Initialize Claude Flow: `npx claude-flow init --force`
7. Spawn hive-mind with issue context
8. Monitor implementation progress
9. Handle feedback and iterations
10. Create PR when complete
11. Clean up workspace entirely

### GitHub Integration
- Poll `/repos/{owner}/{repo}/issues` endpoint with label filter
- Track processed issues to avoid duplicate processing
- Handle API rate limiting with exponential backoff
- Support for GitHub App authentication or personal access tokens

### Service Management
- systemd service unit with proper dependencies
- Automatic restart on failure with reasonable delays
- Environment variable support for configuration
- Log rotation and management

## Dependencies

None - this task can start immediately and runs parallel to other foundation tasks.

## Effort Estimate

**Size: M (16 hours)**

- Service development: 8 hours
- systemd integration: 4 hours  
- Testing and debugging: 3 hours
- Documentation: 1 hour

## Definition of Done

- [ ] Service successfully polls GitHub API every 5 minutes
- [ ] systemd service starts automatically on system boot
- [ ] All error conditions handled gracefully with proper logging
- [ ] Service can run continuously for 24+ hours without issues
- [ ] Configuration is externalized and easily modifiable
- [ ] Basic monitoring and health check capabilities implemented
- [ ] Service passes manual testing with simulated GitHub issues
- [ ] Code follows project coding standards and includes appropriate comments
